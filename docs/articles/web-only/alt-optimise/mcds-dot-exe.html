<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Alternative optimization engine for fitting detection functions • Distance</title>
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><meta property="og:title" content="Alternative optimization engine for fitting detection functions">
<meta name="description" content="Examples demonstrating the use of the mcds.exe alternative optimization engine for fitting single platform detection functions in the Distance and mrds packages.
">
<meta property="og:description" content="Examples demonstrating the use of the mcds.exe alternative optimization engine for fitting single platform detection functions in the Distance and mrds packages.
">
<script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;   y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "m9rbql4acz");</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">Distance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Function reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../../articles/lines-distill.html">Line transects</a></li>
    <li><a class="dropdown-item" href="../../../articles/covariates-distill.html">Covariates in detection</a></li>
    <li><a class="dropdown-item" href="../../../articles/species-covariate-distill.html">Species as a covariate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Only for the website</h6></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/points/pointtransects-distill.html">Point transects</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/groupsize/Remedy-size-bias-for-dolphin-surveys.html">Size bias remedy</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/strata/strata-distill.html">Stratification</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/differences/differences.html">Detecting difference in density between strata</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/variance/variance-distill.html">Variance estimation with bootstrap</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/cues/cuecounts-distill.html">Cue count surveys</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/multipliers/multipliers-distill.html">Indirect surveys</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/multispecies/multispecies-multioccasion-analysis.html">Take care when subsetting multispecies data sets</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/CTDS/camera-distill.html">Camera trap distance sampling</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/alt-optimise/mcds-dot-exe.html">Alternative optimiser</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/Distance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Alternative optimization engine for fitting detection functions</h1>
                        <h4 data-toc-skip class="author">Len Thomas</h4>
            <address class="author_afil">
      CREEM, Univ of St Andrews<br><h4 data-toc-skip class="date">November 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/Distance/blob/HEAD/vignettes/web-only/alt-optimise/mcds-dot-exe.Rmd" class="external-link"><code>vignettes/web-only/alt-optimise/mcds-dot-exe.Rmd</code></a></small>
      <div class="d-none name"><code>mcds-dot-exe.Rmd</code></div>
    </address>
</div>

    
    
<p>Here we demonstrate the use of the alternative optimization engine <code>mcds.exe</code> in the <code>Distance</code> and <code>mrds</code> packages. This engine was introduced with <code>Distance</code> version 1.0.8 and <code>mrds</code> version 2.2.9 to provide an alternative to the built-in optimizer in our <code>R</code> packages – but subsequent improvements in the built-in optimizer implemented in <code>Distance</code> 2.0.0 and <code>mrds</code> 3.0.0 mean that we no longer recommend use of <code>mcds.exe</code>. Nevertheless, the option to use <code>mcds.exe</code> remains open, and may be useful for some users, so we have retained this vignette. We may deprecate the option in future releases.</p>
<p>Note also that this vignette is designed for use within the Microsoft Windows operating system – the <code>mcds.exe</code> engine only has experimental support for MacOS or Linux (see the <code>MCDS.exe</code> help page within the <code>mrds</code> package.for more information).</p>
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<ul>
<li>Download the mcds.exe optimization engine</li>
<li>Demonstrate its use in a simple line transect example (golf tee dataset) via the <code>Distance</code> package</li>
<li>Demonstrate the same example via the <code>mrds</code> package</li>
<li>Demonstrate its use in a point transect example (wren data) where one of the optimizers does not work well (gives a negative estimated detection probability)</li>
<li>Demonstrate its use to speed up an analysis of camera trap distance sampling data (duiker data) via the <code>Distance</code> package</li>
<li>Discuss when using the alternative optimization engine may be useful.</li>
</ul>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>Distance</code> package is designed to provide a simple way to fit detection functions and estimate abundance using conventional distance sampling methodology (i.e., single observer distance sampling, possibly with covariates, as described by Buckland et al. <span class="citation">(2015)</span>). The main function is <code>ds</code>. Underlying <code>Distance</code> is the package <code>mrds</code> – when the function <code>ds</code> is called it does some pre-processing and then calls the function <code>ddf</code> in the <code>mrds</code> package to do the work of detection function fitting. <code>mrds</code> uses maximum likelihood to fit the specified detection function model to the distance data using a built-in algorithm written in <code>R</code>.</p>
<p>An alternative method for analyzing distance sampling data is using the Distance for Windows software <span class="citation">(Thomas et al., 2010)</span>. This software also uses maximum liklihood to fit the detection function models, and relies on software written in the programming language FORTRAN to do the fitting. The filename of this software is <code>MCDS.exe</code>.</p>
<p>In a perfect world, both methods would produce identical results given the same data and model specification, since the likelihood has only one maximum. However, the likelihood surface is sometimes complex, especially when monotonicity constraints are used (which ensures the estimated detection probability is flat or decreasing with increasing distance when adjustment terms are used) or with “overdispersed” or “spiked” data (see Figure 2 in Thomas et al. <span class="citation">(2010)</span>), and so in some (rare) cases one or other piece of software fails to find the maximum. Note that in our tests, we have found this to be extremely rare from <code>Distance</code> version 2.0.0 and <code>mrds</code> version 3.0.0 onwards. Nevertheless, to counteract this, it is possible to run both the <code>R</code>-based optimizer and <code>MCDS.exe</code> from the <code>ds</code> function within the <code>Distance</code> package or the <code>ddf</code> function within <code>mrds</code> package.</p>
<p>Another historical motivation for using the <code>MCDS.exe</code> software from within <code>R</code> was that the <code>R</code>-based optimizer was sometimes slow to converge and so using <code>MCDS.exe</code> in place of the <code>R</code>-based optimizer can then save significant time, particularly when doing a nonparametric bootstrap for large datasets. However, from <code>Distance</code> 2.0.0 and <code>mrds</code> 3.0.0 the <code>R</code>-based optimizer is no longer generally slower.</p>
<p>This vignette demonstrates how to download and then use the MCDS.exe sofware from within the <code>Distance</code> and <code>mrds</code> packages. For more information, see the <code>MCDS.exe</code> help page within the <code>mrds</code> package.</p>
</div>
<div class="section level2">
<h2 id="downloading-and-verifying-mcds-exe">Downloading and verifying MCDS.exe<a class="anchor" aria-label="anchor" href="#downloading-and-verifying-mcds-exe"></a>
</h2>
<p>The program <code>MCDS.exe</code> does not come automatically with the <code>Distance</code> or <code>mrds</code> packages, to avoid violating CRAN rules, so you must first download it from the distance sampling website.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Unload Distance package if it's already loaded in R</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="st">"Distance"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/zpackages.html" class="external-link">.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/detach.html" class="external-link">detach</a></span><span class="op">(</span><span class="st">"package:Distance"</span>, unload<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Download MCDS.exe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"http://distancesampling.org/R/MCDS.exe"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"mrds"</span><span class="op">)</span>,<span class="st">"/MCDS.exe"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in download.file("http://distancesampling.org/R/MCDS.exe",</span></span>
<span><span class="co">## paste0(system.file(package = "mrds"), : URL</span></span>
<span><span class="co">## http://distancesampling.org/R/MCDS.exe: cannot open destfile</span></span>
<span><span class="co">## 'C:/Users/erexs/Documents/R/win-library/4.1/mrds/MCDS.exe', reason 'Permission</span></span>
<span><span class="co">## denied'</span></span></code></pre>
<pre><code><span><span class="co">## Warning in download.file("http://distancesampling.org/R/MCDS.exe",</span></span>
<span><span class="co">## paste0(system.file(package = "mrds"), : download had nonzero exit status</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load the Distance package - now it will be able to use MCDS.exe</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/Distance/" class="external-link">Distance</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: mrds</span></span></code></pre>
<pre><code><span><span class="co">## This is mrds 3.0.0</span></span>
<span><span class="co">## Built: R 4.4.1; ; 2024-10-23 19:10:34 UTC; windows</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'Distance'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:mrds':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     create.bins</span></span></code></pre>
<p>Now that this software is available, both it and the <code>R</code> optimizer will be used by default for each analysis; you can also choose to use just one or the other, as shown below.</p>
</div>
<div class="section level2">
<h2 id="example-with-golf-tee-data">Example with Golf Tee data<a class="anchor" aria-label="anchor" href="#example-with-golf-tee-data"></a>
</h2>
<div class="section level3">
<h3 id="both-mcds-exe-and-the-r-based-optimizer">Both MCDS.exe and the R-based optimizer<a class="anchor" aria-label="anchor" href="#both-mcds-exe-and-the-r-based-optimizer"></a>
</h3>
<p>This example (of golf tee data, using only observer 1) is taken from the <code>R</code> help for the <code>ds</code> function: (There is a warning about cluster sizes being coded as -1 that can be ignored.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">book.tee.data</span><span class="op">)</span></span>
<span><span class="va">tee.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">book.tee.data</span><span class="op">$</span><span class="va">book.tee.dataframe</span>, <span class="va">observer</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#Fit detection function - default is half-normal with cosine adjustments</span></span>
<span><span class="va">ds.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">tee.data</span>, truncation <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 311.138</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with cosine(2) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 313.124</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function selected.</span></span></code></pre>
<pre><code><span><span class="co">## No survey area information supplied, only estimating detection function.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for distance analysis </span></span>
<span><span class="co">## Number of observations :  124 </span></span>
<span><span class="co">## Distance range         :  0  -  4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model       : Half-normal key function </span></span>
<span><span class="co">## AIC         :  311.1385 </span></span>
<span><span class="co">## Optimisation:  mrds (nlminb) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters</span></span>
<span><span class="co">## Scale coefficient(s):  </span></span>
<span><span class="co">##              estimate         se</span></span>
<span><span class="co">## (Intercept) 0.6632435 0.09981249</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Estimate          SE         CV</span></span>
<span><span class="co">## Average p             0.5842744  0.04637627 0.07937412</span></span>
<span><span class="co">## N in covered region 212.2290462 20.85130344 0.09824906</span></span></code></pre>
<p>Assuming you have <code>MCDS.exe</code> installed, the default is that both it and the <code>R</code>-based optimizer are run. Both give the same result in this example, and when this happens the result from the <code>R</code>-based optimizer is used. You can see this from the line of summary output:</p>
<p><code>Optimisation:  mrds (nlminb)</code></p>
<p>where <code>mrds</code> is the <code>R</code> package that the <code>Distance</code> package relies on, and <code>nlminb</code> is the <code>R</code>-based optimizer.</p>
<p>You can see the process of both optimizers being used by setting the <code>debug_level</code> argument of the <code>ds</code> function to a value larger than the default of 0 and then examining the output:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">tee.data</span>, truncation <span class="op">=</span> <span class="fl">4</span>, debug_level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## DEBUG: initial values = -0.1031529</span></span></code></pre>
<pre><code><span><span class="co">## Running MCDS.exe...</span></span></code></pre>
<pre><code><span><span class="co">## Command file written to C:\Users\erexs\AppData\Local\Temp\RtmpsdWor7\cmdtmp46cc6da77768.txt</span></span></code></pre>
<pre><code><span><span class="co">## Stats file written to C:\Users\erexs\AppData\Local\Temp\RtmpsdWor7\stat46cc26507b7a.txt</span></span></code></pre>
<pre><code><span><span class="co">## DEBUG: initial values = 0.6632378 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DEBUG: Convergence! </span></span>
<span><span class="co">##        Iteration  0.0 </span></span>
<span><span class="co">##        Converge   = 0 </span></span>
<span><span class="co">##        nll        = 154.5692 </span></span>
<span><span class="co">##        parameters = 0.6632378</span></span></code></pre>
<pre><code><span><span class="co">## MCDS.exe log likehood: -154.5697</span></span></code></pre>
<pre><code><span><span class="co">## MCDS.exe pars: 1.941067</span></span></code></pre>
<pre><code><span><span class="co">## mrds refitted log likehood: -154.5692276</span></span></code></pre>
<pre><code><span><span class="co">## mrds refitted pars: 0.6632378</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## DEBUG: Convergence! </span></span>
<span><span class="co">##        Iteration  0.0 </span></span>
<span><span class="co">##        Converge   = 0 </span></span>
<span><span class="co">##        nll        = 154.5692 </span></span>
<span><span class="co">##        parameters = 0.6632435</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 311.138</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with cosine(2) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## DEBUG: initial values = -0.1031529 0</span></span></code></pre>
<pre><code><span><span class="co">## Running MCDS.exe...</span></span></code></pre>
<pre><code><span><span class="co">## Command file written to C:\Users\erexs\AppData\Local\Temp\RtmpsdWor7\cmdtmp46cc19ae5459.txt</span></span></code></pre>
<pre><code><span><span class="co">## Stats file written to C:\Users\erexs\AppData\Local\Temp\RtmpsdWor7\stat46cc5f227f6c.txt</span></span></code></pre>
<pre><code><span><span class="co">## DEBUG: initial values = 0.6606793 -0.0159333 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DEBUG: Convergence! </span></span>
<span><span class="co">##        Iteration  0.0 </span></span>
<span><span class="co">##        Converge   = 0 </span></span>
<span><span class="co">##        nll        = 154.5619 </span></span>
<span><span class="co">##        parameters = 0.6606793, -0.0159333</span></span></code></pre>
<pre><code><span><span class="co">## MCDS.exe log likehood: -154.5624</span></span></code></pre>
<pre><code><span><span class="co">## MCDS.exe pars: 1.936107, -0.0159333</span></span></code></pre>
<pre><code><span><span class="co">## mrds refitted log likehood: -154.5619307</span></span></code></pre>
<pre><code><span><span class="co">## mrds refitted pars: 0.6606793, -0.0159333</span></span></code></pre>
<pre><code><span><span class="co">## iteration: 1</span></span>
<span><span class="co">##  f(x) = 243.539291</span></span>
<span><span class="co">## iteration: 2</span></span>
<span><span class="co">##  f(x) = 164.079444</span></span>
<span><span class="co">## iteration: 3</span></span>
<span><span class="co">##  f(x) = 156.273060</span></span>
<span><span class="co">## iteration: 4</span></span>
<span><span class="co">##  f(x) = 155.340034</span></span>
<span><span class="co">## iteration: 5</span></span>
<span><span class="co">##  f(x) = 154.684098</span></span>
<span><span class="co">## iteration: 6</span></span>
<span><span class="co">##  f(x) = 154.571590</span></span>
<span><span class="co">## iteration: 7</span></span>
<span><span class="co">##  f(x) = 154.562292</span></span>
<span><span class="co">## iteration: 8</span></span>
<span><span class="co">##  f(x) = 154.561975</span></span>
<span><span class="co">## iteration: 9</span></span>
<span><span class="co">##  f(x) = 154.561931</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DEBUG: Convergence! </span></span>
<span><span class="co">##        Iteration  0.0 </span></span>
<span><span class="co">##        Converge   = 0 </span></span>
<span><span class="co">##        nll        = 154.5619 </span></span>
<span><span class="co">##        parameters = 0.6606883, -0.0159336 </span></span>
<span><span class="co">## DEBUG: MCDS lnl = -154.5619        mrds lnl = 154.5619</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 313.124</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function selected.</span></span></code></pre>
<pre><code><span><span class="co">## No survey area information supplied, only estimating detection function.</span></span></code></pre>
<p>First the half-normal with no adjustments is run; for this model the <code>MCDS.exe</code> software is run first, followed by the <code>R</code>-based (<code>mrds</code>) optimizer. Both converge and both give the same <code>nll</code> (negative log-likelihood) or 154.5692, giving an AIC of 311.138. The model with half-normal and a cosine adjustment of order 2 is then fitted to the data, with first the <code>MCDS.exe</code> optimizer and then the <code>R</code>-based optimizer. Again both give the same result of nll 154.5619 and an AIC of 313.124. This is higher than the AIC with no adjustments so half-normal with no adjustments is chosen.</p>
<p>In this case, both optimizers produced the same result, so there is no benefit to run <code>MCDS.exe</code>.</p>
</div>
<div class="section level3">
<h3 id="specifying-which-optimzier-to-run">Specifying which optimzier to run<a class="anchor" aria-label="anchor" href="#specifying-which-optimzier-to-run"></a>
</h3>
<p>As we said earlier, the default behaviour when <code>MCDS.exe</code> has been downloaded is to run both <code>MCDS.exe</code> and the <code>R</code>-based optimizer. However, the <code>optimizer</code> argument can be used to specify which to use – either <code>both</code>, <code>R</code> or <code>MCDS</code>. Here is an example with just the <code>MCDS.exe</code> optimizer:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">tee.data</span>, truncation <span class="op">=</span> <span class="fl">4</span>, optimizer <span class="op">=</span> <span class="st">"MCDS"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 311.138</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with cosine(2) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 313.124</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function selected.</span></span></code></pre>
<pre><code><span><span class="co">## No survey area information supplied, only estimating detection function.</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for distance analysis </span></span>
<span><span class="co">## Number of observations :  124 </span></span>
<span><span class="co">## Distance range         :  0  -  4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model       : Half-normal key function </span></span>
<span><span class="co">## AIC         :  311.1385 </span></span>
<span><span class="co">## Optimisation:  MCDS.exe </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters</span></span>
<span><span class="co">## Scale coefficient(s):  </span></span>
<span><span class="co">##              estimate         se</span></span>
<span><span class="co">## (Intercept) 0.6632378 0.09981136</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Estimate          SE         CV</span></span>
<span><span class="co">## Average p             0.5842718  0.04637577 0.07937362</span></span>
<span><span class="co">## N in covered region 212.2300013 20.85133459 0.09824876</span></span></code></pre>
<p>The summary output now says <code>Optimisation:  MCDS.exe</code>.</p>
</div>
<div class="section level3">
<h3 id="demonstration-using-ddf-in-mrds-package">Demonstration using <code>ddf</code> in <code>mrds</code> package<a class="anchor" aria-label="anchor" href="#demonstration-using-ddf-in-mrds-package"></a>
</h3>
<p>Here we demonstrate using both optimizers in the <code>ddf</code> function, rather than via <code>ds</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Half normal detection function</span></span>
<span><span class="va">ddf.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrds/man/ddf.html" class="external-link">ddf</a></span><span class="op">(</span>dsmodel <span class="op">=</span> <span class="op">~</span><span class="fu">mcds</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"hn"</span>, formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">tee.data</span>, method <span class="op">=</span> <span class="st">"ds"</span>,</span>
<span>                 meta.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Half normal with cos(2) adjustment</span></span>
<span><span class="va">ddf.model.cos2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrds/man/ddf.html" class="external-link">ddf</a></span><span class="op">(</span>dsmodel <span class="op">=</span> <span class="op">~</span><span class="fu">mcds</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"hn"</span>, adj.series <span class="op">=</span> <span class="st">"cos"</span>, adj.order <span class="op">=</span> <span class="fl">2</span>, formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">tee.data</span>, method <span class="op">=</span> <span class="st">"ds"</span>, meta.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Compare with AIC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ddf.model</span>, <span class="va">ddf.model.cos2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                df      AIC</span></span>
<span><span class="co">## ddf.model       1 311.1385</span></span>
<span><span class="co">## ddf.model.cos2  2 313.1239</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Model with no adjustment term has lower AIC; show summary of this model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ddf.model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for ds object</span></span>
<span><span class="co">## Number of observations :  124 </span></span>
<span><span class="co">## Distance range         :  0  -  4 </span></span>
<span><span class="co">## AIC                    :  311.1385 </span></span>
<span><span class="co">## Optimisation           :  mrds (nlminb) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function:</span></span>
<span><span class="co">##  Half-normal key function </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters </span></span>
<span><span class="co">## Scale coefficient(s): </span></span>
<span><span class="co">##              estimate         se</span></span>
<span><span class="co">## (Intercept) 0.6632435 0.09981249</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Estimate          SE         CV</span></span>
<span><span class="co">## Average p             0.5842744  0.04637627 0.07937412</span></span>
<span><span class="co">## N in covered region 212.2290462 20.85130344 0.09824906</span></span></code></pre>
<p>As an exercise, fit using just the <code>MCDS.exe</code> optimizer:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddf.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrds/man/ddf.html" class="external-link">ddf</a></span><span class="op">(</span>dsmodel <span class="op">=</span> <span class="op">~</span><span class="fu">mcds</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"hn"</span>, adj.series <span class="op">=</span> <span class="st">"cos"</span>, adj.order <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                               formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">tee.data</span>, method <span class="op">=</span> <span class="st">"ds"</span>,</span>
<span>                 meta.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                 control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="st">"MCDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ddf.model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for ds object</span></span>
<span><span class="co">## Number of observations :  124 </span></span>
<span><span class="co">## Distance range         :  0  -  4 </span></span>
<span><span class="co">## AIC                    :  313.1239 </span></span>
<span><span class="co">## Optimisation           :  MCDS.exe </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function:</span></span>
<span><span class="co">##  Half-normal key function with cosine adjustment term of order 2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters </span></span>
<span><span class="co">## Scale coefficient(s): </span></span>
<span><span class="co">##              estimate        se</span></span>
<span><span class="co">## (Intercept) 0.6606782 0.1043327</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Adjustment term coefficient(s):  </span></span>
<span><span class="co">##                 estimate        se</span></span>
<span><span class="co">## cos, order 2 -0.01593274 0.1351281</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Estimate          SE        CV</span></span>
<span><span class="co">## Average p             0.5925856  0.08165144 0.1377884</span></span>
<span><span class="co">## N in covered region 209.2524623 31.22790760 0.1492356</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="point-transect-example---wren-data">Point transect example - wren data<a class="anchor" aria-label="anchor" href="#point-transect-example---wren-data"></a>
</h2>
<p>This is an example of point transect data for a bird (wren), from Buckland <span class="citation">(2006)</span>. In this case one of the optimizers fails correctly to constrain the detection function so the probability of detection is more than zero at all distances, and so we use the other optimizer for inference.</p>
<p>We load the wren 5 minute example dataset and define cutpoints for the distances (they were collected in intervals).</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wren_5min"</span><span class="op">)</span></span>
<span><span class="va">bin.cutpoints.100m</span> <span class="op">&lt;-</span> <span class="va">bin.cutpoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The following call to <code>ds</code> gives several warnings. Some warnings are about the detection function being less than zero at some distances. There is also a warning about the Hessian (which is used for variance estimation), but this relates to the Hermite(4, 6) model (i.e., two Hermite adjustment terms of order 4 and 6) which is not chosen using AIC and so this warning can be ignored.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wren5min.hn.herm.t100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wren_5min</span>, key <span class="op">=</span> <span class="st">"hn"</span>, adjustment <span class="op">=</span> <span class="st">"herm"</span>, </span>
<span>                            transect <span class="op">=</span> <span class="st">"point"</span>, cutpoints <span class="op">=</span> <span class="va">bin.cutpoints.100m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in create_bins(data, cutpoints): Some distances were outside bins and</span></span>
<span><span class="co">## have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 427.471</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## Warning in check.mono(result, n.pts = control$mono.points): Detection function</span></span>
<span><span class="co">## is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## Warning in check.mono(result, n.pts = control$mono.points): Detection function</span></span>
<span><span class="co">## is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 422.228</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4,6) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## Warning: First partial hessian is singular and second-partial hessian is NULL, no hessian</span></span>
<span><span class="co">## Warning: Detection function is less than 0 at some distances</span></span>
<span><span class="co">## Warning: Detection function is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 423.255</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function with Hermite(4) adjustments selected.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in mrds::check.mono(model, n.pts = 10): Detection function is less than</span></span>
<span><span class="co">## 0 at some distances</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wren5min.hn.herm.t100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for distance analysis </span></span>
<span><span class="co">## Number of observations :  132 </span></span>
<span><span class="co">## Distance range         :  0  -  100 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model       : Half-normal key function with Hermite polynomial adjustment term of order 4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Strict monotonicity constraints were enforced.</span></span>
<span><span class="co">## AIC         :  422.2284 </span></span>
<span><span class="co">## Optimisation:  MCDS.exe </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters</span></span>
<span><span class="co">## Scale coefficient(s):  </span></span>
<span><span class="co">##             estimate    se</span></span>
<span><span class="co">## (Intercept) 12.08697 1e+05</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Adjustment term coefficient(s):  </span></span>
<span><span class="co">##                estimate         se</span></span>
<span><span class="co">## herm, order 4 0.5723854 0.07888508</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Estimate         SE         CV</span></span>
<span><span class="co">## Average p             0.4399177  0.0253475 0.05761875</span></span>
<span><span class="co">## N in covered region 300.0561563 26.0944820 0.08696533</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary statistics:</span></span>
<span><span class="co">##     Region Area CoveredArea Effort   n  k     ER     se.ER      cv.ER</span></span>
<span><span class="co">## 1 Montrave 33.2     2010619     64 132 32 2.0625 0.1901692 0.09220324</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##   Label    Estimate           se        cv         lcl         ucl       df</span></span>
<span><span class="co">## 1 Total 0.004954625 0.0005386969 0.1087261 0.003988075 0.006155428 57.83608</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Density:</span></span>
<span><span class="co">##   Label     Estimate           se        cv          lcl          ucl       df</span></span>
<span><span class="co">## 1 Total 0.0001492357 1.622581e-05 0.1087261 0.0001201227 0.0001854045 57.83608</span></span></code></pre>
<p>The <code>MCDS.exe</code> optimizer is the chosen one (see the `Optimisation’ line of output).</p>
<p>The warnings persist if only the <code>MCDS.exe</code> optimizer is used:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wren5min.hn.herm.t100.mcds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wren_5min</span>, key <span class="op">=</span> <span class="st">"hn"</span>, adjustment <span class="op">=</span> <span class="st">"herm"</span>, </span>
<span>                            transect <span class="op">=</span> <span class="st">"point"</span>, cutpoints <span class="op">=</span> <span class="va">bin.cutpoints.100m</span>,</span>
<span>                            optimizer <span class="op">=</span> <span class="st">"MCDS"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in create_bins(data, cutpoints): Some distances were outside bins and</span></span>
<span><span class="co">## have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 427.471</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## Warning in check.mono(result, n.pts = control$mono.points): Detection function</span></span>
<span><span class="co">## is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## Warning in check.mono(result, n.pts = control$mono.points): Detection function</span></span>
<span><span class="co">## is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 422.228</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4,6) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## Warning: First partial hessian is singular and second-partial hessian is NULL, no hessian</span></span>
<span><span class="co">## Warning: Detection function is less than 0 at some distances</span></span>
<span><span class="co">## Warning: Detection function is less than 0 at some distances</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 423.255</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function with Hermite(4) adjustments selected.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in mrds::check.mono(model, n.pts = 10): Detection function is less than</span></span>
<span><span class="co">## 0 at some distances</span></span></code></pre>
<p>Looking at a plot of the fitted object (Figure <a href="#fig:mcds">1</a>), it seems that the evaluated pdf is less than 0 at distances close to the truncation point (approx. 95m and greater):</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wren5min.hn.herm.t100.mcds</span>, pdf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:mcds"></span>
<img src="mcds-dot-exe_files/figure-html/mcds-1.png" alt="PDF of fitted model with MCDS optimizer."><p class="caption">
Figure 1: PDF of fitted model with MCDS optimizer.
</p>
</div>
<p>What appears to be happening here is a failure of the optimization routine to appropriately constrain the model parameters so that the detection function is valid. This happens on occasion (the routines aren’t perfect!) and where it does we recommend trying the other optimization routine. Here we use the <code>R</code>-based optimizer:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wren5min.hn.herm.t100.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">wren_5min</span>, key<span class="op">=</span><span class="st">"hn"</span>, adjustment<span class="op">=</span><span class="st">"herm"</span>, </span>
<span>                            transect<span class="op">=</span><span class="st">"point"</span>, cutpoints<span class="op">=</span><span class="va">bin.cutpoints.100m</span>,</span>
<span>                            optimizer <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in create_bins(data, cutpoints): Some distances were outside bins and</span></span>
<span><span class="co">## have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Starting AIC adjustment term selection.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 427.471</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 422.73</span></span></code></pre>
<pre><code><span><span class="co">## Fitting half-normal key function with Hermite(4,6) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 424.717</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Half-normal key function with Hermite(4) adjustments selected.</span></span></code></pre>
<p>Here the fitted AIC for the chosen model (half normal with one Hermite adjustment of order 4) is 422.73, higher than that with the <code>MCDS.exe</code> optimizer (which was 422.23), which explains why the <code>MCDS.exe</code> optimizer fit was chosen when we allowed <code>ds</code> to choose freely. However, the detection function fit from <code>MCDS.exe</code> was invalid, because it went lower than 0 at about 95m, while the fit with the <code>R</code>-based optimizer looks valid (Figure <a href="#fig:usingr">2</a>):</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wren5min.hn.herm.t100.r</span>, pdf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:usingr"></span>
<img src="mcds-dot-exe_files/figure-html/usingr-1.png" alt="PDF of fitted model with R-based optimizer."><p class="caption">
Figure 2: PDF of fitted model with R-based optimizer.
</p>
</div>
<p>Hence in this case, we would use the <code>R</code>-based optimizer’s fit.</p>
</div>
<div class="section level2">
<h2 id="camera-trap-example">Camera trap example<a class="anchor" aria-label="anchor" href="#camera-trap-example"></a>
</h2>
<p>For this example, it helps if you are familiar with the <a href="https://distancedevelopment.github.io/Distance/articles/web-only/CTDS/camera-distill.html" class="external-link">Analysis of camera trapping data</a> vignette on the distance sampling web site.</p>
<p>You also need to <a href="https://datadryad.org/stash/downloads/file_stream/73221" class="external-link">Download from the Dryad data repository</a> the detection distances for the full daytime data set and then read it in with the code below:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Read in data and set up data for analysis</span></span>
<span><span class="va">DuikerCameraTraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"DaytimeDistances.txt"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">Area</span> <span class="op">&lt;-</span> <span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">Area</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">object</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">object</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">DuikerCameraTraps</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Specify breakpoints and truncation</span></span>
<span><span class="va">trunc.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>left<span class="op">=</span><span class="fl">2</span>, right<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">mybreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit the detection function selected in the camera trap vignette, uniform plus 3 cosine adjustment terms, and time how long the fitting takes:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">uni3.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">DuikerCameraTraps</span>, transect <span class="op">=</span> <span class="st">"point"</span>, key<span class="op">=</span><span class="st">"unif"</span>, adjustment <span class="op">=</span> <span class="st">"cos"</span>,</span>
<span>           nadj<span class="op">=</span><span class="fl">3</span>, cutpoints <span class="op">=</span> <span class="va">mybreaks</span>, truncation <span class="op">=</span> <span class="va">trunc.list</span>, optimizer <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in create_bins(data, cutpoints): Some distances were outside bins and</span></span>
<span><span class="co">## have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting uniform key function with cosine(1,2,3) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 44012.238</span></span></code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R.opt.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start.time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">uni3.r</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for distance analysis </span></span>
<span><span class="co">## Number of observations :  10284 </span></span>
<span><span class="co">## Distance range         :  2  -  15 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model       : Uniform key function with cosine adjustment terms of order 1,2,3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Strict monotonicity constraints were enforced.</span></span>
<span><span class="co">## AIC         :  44012.24 </span></span>
<span><span class="co">## Optimisation:  mrds (slsqp) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters</span></span>
<span><span class="co">## Scale coefficient(s):  </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Adjustment term coefficient(s):  </span></span>
<span><span class="co">##                 estimate         se</span></span>
<span><span class="co">## cos, order 1  0.93529846 0.01504415</span></span>
<span><span class="co">## cos, order 2 -0.05342058 0.02438026</span></span>
<span><span class="co">## cos, order 3 -0.08069257 0.01557680</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                         Estimate           SE         CV</span></span>
<span><span class="co">## Average p           3.290022e-01 1.349494e-02 0.04101777</span></span>
<span><span class="co">## N in covered region 3.125815e+04 1.306764e+03 0.04180555</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary statistics:</span></span>
<span><span class="co">##   Region  Area CoveredArea   Effort     n  k           ER        se.ER    cv.ER</span></span>
<span><span class="co">## 1    Tai 40.37 21858518573 31483179 10284 21 0.0003266506 8.763252e-05 0.268276</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##   Label     Estimate           se        cv          lcl          ucl       df</span></span>
<span><span class="co">## 1 Total 5.772996e-05 1.566754e-05 0.2713936 3.315829e-05 0.0001005103 20.94597</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Density:</span></span>
<span><span class="co">##   Label     Estimate           se        cv          lcl          ucl       df</span></span>
<span><span class="co">## 1 Total 1.430021e-06 3.880986e-07 0.2713936 8.213597e-07 2.489727e-06 20.94597</span></span></code></pre>
<p>Fitting takes 10 secs. (Note, in versions of <code>Distance</code> before 2.0.0 this was a much higher number!) Here we try the <code>MCDS.exe</code> optimizer:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">uni3.mcds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">DuikerCameraTraps</span>, transect <span class="op">=</span> <span class="st">"point"</span>, key<span class="op">=</span><span class="st">"unif"</span>, adjustment <span class="op">=</span> <span class="st">"cos"</span>,</span>
<span>                nadj<span class="op">=</span><span class="fl">3</span>, cutpoints <span class="op">=</span> <span class="va">mybreaks</span>, truncation <span class="op">=</span> <span class="va">trunc.list</span>, optimizer <span class="op">=</span> <span class="st">"MCDS"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in create_bins(data, cutpoints): Some distances were outside bins and</span></span>
<span><span class="co">## have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Fitting uniform key function with cosine(1,2,3) adjustments</span></span></code></pre>
<pre><code><span><span class="co">## AIC= 44012.211</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MCDS.opt.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start.time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">uni3.mcds</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Summary for distance analysis </span></span>
<span><span class="co">## Number of observations :  10284 </span></span>
<span><span class="co">## Distance range         :  2  -  15 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model       : Uniform key function with cosine adjustment terms of order 1,2,3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Strict monotonicity constraints were enforced.</span></span>
<span><span class="co">## AIC         :  44012.21 </span></span>
<span><span class="co">## Optimisation:  MCDS.exe </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection function parameters</span></span>
<span><span class="co">## Scale coefficient(s):  </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Adjustment term coefficient(s):  </span></span>
<span><span class="co">##                 estimate         se</span></span>
<span><span class="co">## cos, order 1  0.93518220 0.01504583</span></span>
<span><span class="co">## cos, order 2 -0.05345965 0.02438049</span></span>
<span><span class="co">## cos, order 3 -0.08073799 0.01557817</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                         Estimate           SE         CV</span></span>
<span><span class="co">## Average p           3.290679e-01 1.349917e-02 0.04102246</span></span>
<span><span class="co">## N in covered region 3.125191e+04 1.306645e+03 0.04181008</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary statistics:</span></span>
<span><span class="co">##   Region  Area CoveredArea   Effort     n  k           ER        se.ER    cv.ER</span></span>
<span><span class="co">## 1    Tai 40.37 21858518573 31483179 10284 21 0.0003266506 8.763252e-05 0.268276</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##   Label     Estimate           se        cv          lcl          ucl       df</span></span>
<span><span class="co">## 1 Total 5.771844e-05 1.566445e-05 0.2713943 3.315164e-05 0.0001004903 20.94619</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Density:</span></span>
<span><span class="co">##   Label     Estimate           se        cv         lcl          ucl       df</span></span>
<span><span class="co">## 1 Total 1.429736e-06 3.880222e-07 0.2713943 8.21195e-07 2.489232e-06 20.94619</span></span></code></pre>
<p>This took a little less time: 9 secs. Hence, for some datasets, it may be quicker to use the <code>MCDS.exe</code> optimizer. This could make a significant difference if using the nonparametric bootstrap to estimate variance. However, after making improvements to the optimizer in <code>mrds</code> 3.0.0 and <code>Distance</code> 2.0.0 the difference is generally small, and in many cases the <code>R</code> optimizer is faster than <code>MCDS.exe</code> so this is likely not a productive avenue to pursue in general.</p>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>We have shown how to fit distance sampling detection functions (for single platform data) using either the <code>R</code>-based optimizer built into the <code>ddf</code> function (via calling <code>ddf</code> or, more likely, calling the <code>ds</code> function in the <code>Distance</code> package) or the <code>MCDS.exe</code> analysis engine used by Distance for Windows. In the vast majority of cases both fitting methods give the same result, and so there is no need to use both. However, the only downside is that fitting takes longer, as each is called in turn. If you have downloaded the <code>MCDS.exe</code> file and want to speed things up, you can use just the <code>R</code>-based optimizer by specifying <code>optimizer = "R"</code> in the call to <code>ds</code> or <code>ddf</code>, or just the <code>MCDS.exe</code> optimizer with <code>optimizer = "MCDS"</code>.</p>
<p>Some situations where the two may produce different results are given below. Note that in each case we give an update related to new algorithms developed and used in <code>mrds</code> 3.0.0.</p>
<ul>
<li>
<p>Detection functions that are close to non-monotonic or close to zero at some distances. When adjustment terms are used in the detection function, then constraints are required to prevent the fitted function from having “bumps” where detection probability increases with increasing distance and also to prevent detection probability from becoming less than zero. The former are called monotonicity constraints and are set using the <code>monotonicity</code> argument in <code>ds</code> or in the <code>meta.data</code> argument in <code>ddf</code>; monotonicity is set on by default. In practice, monotonicity and values less than zero are monitored at a finite set of distances between the 0 and the right truncation point, and (for historical reasons) this set of distances is different for the <code>R</code>-based and <code>MCDS.exe</code> optimizers. This typically makes no difference to the optimization, but particularly in borderline cases it can result in different fitted functions. Plotting the fitted functions (as we did in the wren example above) can reveal when there is an issue with a fitted function, and if this occurs the associated optimizer should not be used. In the future we plan to bring the two into line so they use the same distances for checking.</p>
<ul>
<li>Update: As of <code>mrds</code> 3.0.0 and <code>Distance</code> 2.0.0 these are now aligned, so this difference should have gone away.</li>
</ul>
</li>
<li><p>Detection functions with many adjustment terms. The two optimizers use different algorithms for optimization: the <code>R</code>-based optimizer uses a routine called <code>nlminb</code> while <code>MCDS.exe</code> uses a nonlinear constrained optimizer routine produced by the IMSL group. In cases where there are multiple adjustment terms, and hence several parameters to estimate (that are often correlated) the likelihood maximization is harder, and one or other routine can sometimes fail to find the maximum. In this case, choosing the routine with the higher likelihood (i.e., lower negative log-likelihod, or equivalently lower AIC) is the right thing to do, and this is the default behaviour of the software.</p></li>
<li><p>Update: in <code>mrds</code> 3.0.0 we now use a Sequential Least Squares Programming (SLSQP) algorithm from the ‘nloptr’ package via <code>nlminb</code> in the <code>R</code>-based optimizer (rather than the old solnp algorithm). The old algorithm can be accessed from the <code>ds</code>() function in <code>Distance</code> using the argument <code>mono_method = "solnp"</code> or with the <code>ddf</code>() function in <code>mrds</code> using the argument <code>control(mono.method = "solnp")</code>. However, the new one shows improved performance in our testing, and so we do not recommend using the old algorithm except for reasons of backwards compatibility.</p></li>
<li><p>Detection functions that are “overdispersed” or with a “spike” in the detection function close to zero distance. Similarly to the above, the detection function can then be hard to maximize and hence on or other optimizer can fail to find the maximum. Solution is as above. Overdispersed data is common in camera trap distance sampling because many detections can be generated by the same individual crossing in front of the camera.</p></li>
<li><p>Update is as above.</p></li>
</ul>
<p>If you are interested in seeing more comparisons of the optimizers on various datasets, we maintain a test suite of both straightforward and challenging datasets together with test code to run and compare the two optimizers – this is available at the <a href="https://github.com/DistanceDevelopment/MCDS_mrds_compare" class="external-link">MCDS_mrds_compare repository</a>.</p>
<p>If you encounter difficulties when using both optimizers, one possible troubleshooting step is to run the analysis first choosing one optimizer (e.g., specifing the argument <code>optimizer = "MCDS"</code>) and then choosing the other (<code>optimizer = "R"</code>). This allows you clearly to see what the output of each optimizer is (including any error messages) and facilitates their comparison.</p>
<p>One other criterion to favour one optimizer over the other is speed. We found that for large datasets the <code>MCDS.exe</code> optimizer was quicker, but as of <code>Distance</code> 2.0.0 and <code>mrds</code> 3.0.0 this is no longer necessarily the case.</p>
<p>One thing to note is that the <code>MCDS.exe</code> file will get deleted each time you update the <code>mrds</code> package, so you’ll need to re-download the file if you want to continue using the <code>MCDS.exe</code> optimizer. As shown above, this only requires running one line of code.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Buckland2006" class="csl-entry">
Buckland, S. T. (2006). Point transect surveys for songbirds: Robust methodologies. <em>The Auk</em>, <em>123</em>(2), 345–345. <a href="https://doi.org/10.1642/0004-8038(2006)123%5B345:psfsrm%5D2.0.co;2" class="external-link">https://doi.org/10.1642/0004-8038(2006)123[345:psfsrm]2.0.co;2</a>
</div>
<div id="ref-buckland2015distance" class="csl-entry">
Buckland, S., Rexstad, E., Marques, T., &amp; Oedekoven, C. (2015). <em>Distance sampling: Methods and applications</em>. Springer.
</div>
<div id="ref-Thomas2010" class="csl-entry">
Thomas, L., Buckland, S. T., Rexstad, E. A., Laake, J. L., Strindberg, S., Hedley, S. L., … Marques, T. A. (2010). Distance software: Design and analysis of distance sampling surveys for estimating population size. <em>Journal of Applied Ecology</em>, <em>47</em>, 5–14. <a href="https://doi.org/110.1111/j.1365-2664.2009.01737.x" class="external-link">https://doi.org/110.1111/j.1365-2664.2009.01737.x</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer>
</div>





  </body>
</html>
