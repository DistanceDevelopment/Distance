<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Detecting density estimate differences â€¢ Distance</title>
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><script src="../../../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><meta property="og:title" content="Detecting density estimate differences">
<meta name="description" content="Using the bootstrap to derive the sampling distribution of pairwise differences in estimated density.
">
<meta property="og:description" content="Using the bootstrap to derive the sampling distribution of pairwise differences in estimated density.
">
<script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;   y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "m9rbql4acz");</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">Distance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Function reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../../articles/lines-distill.html">Line transects</a></li>
    <li><a class="dropdown-item" href="../../../articles/covariates-distill.html">Covariates in detection</a></li>
    <li><a class="dropdown-item" href="../../../articles/species-covariate-distill.html">Species as a covariate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Only for the website</h6></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/points/pointtransects-distill.html">Point transects</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/groupsize/Remedy-size-bias-for-dolphin-surveys.html">Size bias remedy</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/strata/strata-distill.html">Stratification</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/differences/differences.html">Detecting difference in density between strata</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/variance/variance-distill.html">Variance estimation with bootstrap</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/cues/cuecounts-distill.html">Cue count surveys</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/multipliers/multipliers-distill.html">Indirect surveys</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/multispecies/multispecies-multioccasion-analysis.html">Take care when subsetting multispecies data sets</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/CTDS/camera-distill.html">Camera trap distance sampling</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/alt-optimise/mcds-dot-exe.html">Alternative optimiser</a></li>
    <li><a class="dropdown-item" href="../../../articles/web-only/predict_detprob/predicting_detection_probabilities.html">Predict detection probabilities</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/Distance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Detecting density estimate differences</h1>
                        <h4 data-toc-skip class="author">Eric Rexstad</h4>
            <address class="author_afil">
      CREEM, Univ of St Andrews<br><h4 data-toc-skip class="date">March 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/Distance/blob/HEAD/vignettes/web-only/differences/differences.Rmd" class="external-link"><code>vignettes/web-only/differences/differences.Rmd</code></a></small>
      <div class="d-none name"><code>differences.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="management-context">Management context<a class="anchor" aria-label="anchor" href="#management-context"></a>
</h2>
<p>Often ecological questions extend beyond simply wanting an estimate of density in a study region. It is common for inference to extend to differences in density over time or space.</p>
</div>
<div class="section level2">
<h2 id="conventional-analysis">Conventional analysis<a class="anchor" aria-label="anchor" href="#conventional-analysis"></a>
</h2>
<p>In <span class="citation">Buckland et al. (2001, Sect. 3.6.5)</span> methods are described to produce tests of significance based on t-test methods. That section presents formulas for comparing two density estimates under two scenarios</p>
<ul>
<li>the two estimates have separate detection functions, or</li>
<li>the estimates share a common detection function.</li>
</ul>
<p>The situation that <span class="citation">Buckland et al. (2001)</span> does not consider is the situation in which the two estimates are linked via a covariate in the detection function. Because the t-test framework cannot deal with this intermediate situation, an alternative approach, employing the bootstrap, can be employed. The bootstrap provides the added advantage that no parametric assumptions (<em>t</em>-distribution) need to be invoked when making inference.</p>
</div>
<div class="section level2">
<h2 id="bootstrap-analysis">Bootstrap analysis<a class="anchor" aria-label="anchor" href="#bootstrap-analysis"></a>
</h2>
<p>A function in the Distance R package <span class="citation">(Miller, Rexstad, Thomas, Marshall, &amp; Laake, 2019)</span> exists for computing uncertainty in density estimates via bootstrapping. This vignette demonstrates a function that harnesses the <code>bootdht</code> function to produce a sampling distribution of the difference between pairs of density estimates embedded as strata within a data set.</p>
<p>Recognise that strata can represent not only geographic divisions of a study area, but potentially also a survey of the same study area at another time. If a data set is organised in this manner, then the assessment of differences between strata would be an assessment of the possible change in density over time. Furthermore, as shown in the example of <a href="https://distancedevelopment.github.io/Distance/articles/species-covariate-distill.html" class="external-link">multi-species surveys</a>, species could serve as strata. In this context, assessing the difference in stratum-specific density would examine the difference in density between species.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title differences.bootstrap</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @description Test for pairwise density differences between strata</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Test is performed by producing replicate stratum-specific estimates and calculating</span></span>
<span><span class="co">#' differences of each replicate.  Differencing is done for all pairs of strata in</span></span>
<span><span class="co">#' the survey, e.g. if there are 4 strata there are \code{choose(4,2)=6} pairwise </span></span>
<span><span class="co">#' comparisons computed.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' Histograms are produced for each comparison, designating the median of the distribution</span></span>
<span><span class="co">#' and a percentile-based 95% confidence interval from the sampling distribution</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' Difficulties can arise from very long left or right tails of the distribution</span></span>
<span><span class="co">#' resulting from awkward bootstrap replicates.  The limits of the histogram are</span></span>
<span><span class="co">#' cut off at 5*median so histogram shape does not appear degenerate. Code presumes differences will be positive.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param dsobj dsmodel object generated by \code{ds}</span></span>
<span><span class="co">#' @param flatfile flatfile of survey data analysed by \code{ds}</span></span>
<span><span class="co">#' @param nboot number of bootstrap replicates to compute</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Histogram showing sampling distribution of differences plus named list</span></span>
<span><span class="co">#' \itemize{</span></span>
<span><span class="co">#'   \item medians - median of sampling distribution</span></span>
<span><span class="co">#'   \item ps - P-value for two-tailed test that difference is zero</span></span>
<span><span class="co">#'   \item thematrix - Matrix of replicate pairwise differences</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' @importFrom Distance bootdht</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' library(Distance)</span></span>
<span><span class="co">#' data(minke)</span></span>
<span><span class="co">#' hn.pooled &lt;- ds(minke)  # pooled detection function with hn key</span></span>
<span><span class="co">#' result &lt;- differences.bootstrap(hn.pooled, minke, nboot=100)</span></span>
<span><span class="va">differences.bootstrap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dsobj</span>, <span class="va">flatfile</span>, <span class="va">nboot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">num.strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dsobj</span><span class="op">$</span><span class="va">dht</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">D</span><span class="op">$</span><span class="va">Estimate</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span></span>
<span>    <span class="st">'first argument is not a dsmodel object'</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dsobj</span><span class="op">)</span> <span class="op">==</span> <span class="st">'dsmodel'</span>,</span>
<span>    <span class="st">'study area must have &gt;1 stratum'</span>                  <span class="op">=</span> <span class="va">num.strata</span> <span class="op">&gt;</span> <span class="fl">1</span>,</span>
<span>    <span class="st">'specified flatfile object is not a data.frame   '</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">flatfile</span><span class="op">)</span> <span class="op">==</span> <span class="st">'data.frame'</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">d.point.ests</span> <span class="op">&lt;-</span> <span class="va">dsobj</span><span class="op">$</span><span class="va">dht</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">D</span><span class="op">$</span><span class="va">Estimate</span></span>
<span>  <span class="va">strata.names</span> <span class="op">&lt;-</span> <span class="va">dsobj</span><span class="op">$</span><span class="va">dht</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">D</span><span class="op">$</span><span class="va">Label</span></span>
<span><span class="co">#   Following function used by bootdht to collect density point estimates</span></span>
<span><span class="co">#     from each bootstrap replicate</span></span>
<span>  <span class="va">pullout.D</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ests</span>, <span class="va">fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bill</span> <span class="op">&lt;-</span> <span class="va">ests</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">D</span><span class="op">$</span><span class="va">Estimate</span></span>
<span>    <span class="va">extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">bill</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extract</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ests</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">D</span><span class="op">$</span><span class="va">Label</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">extract</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/bootdht.html">bootdht</a></span><span class="op">(</span><span class="va">dsobj</span>, flatfile<span class="op">=</span><span class="va">flatfile</span>, cores<span class="op">=</span><span class="fl">10</span>,</span>
<span>                     summary_fun<span class="op">=</span><span class="va">pullout.D</span>, nboot<span class="op">=</span><span class="va">nboot</span><span class="op">)</span></span>
<span><span class="co">#   Having run the bootstrap, calculate number of pairwise comparisons btwn strata</span></span>
<span><span class="co">#     create objects to receive the replicate-wise differences for each comparison</span></span>
<span><span class="co">#     median differences are reported and empirical P-value computed for each comparison</span></span>
<span><span class="co">#     histograms of sampling distribution for differences are shown with CIs</span></span>
<span><span class="co">#  allstrata &lt;- complete.cases(outcome)</span></span>
<span>  <span class="va">num.compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">choose</a></span><span class="op">(</span><span class="va">num.strata</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.strata</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">num.compare</span><span class="op">)</span></span>
<span>  <span class="va">themedian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="va">num.compare</span><span class="op">)</span></span>
<span>  <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="va">num.compare</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">num.compare</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num.compare</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result.matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="st">'-'</span>, <span class="va">outcome</span><span class="op">[</span><span class="va">pairs</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">outcome</span><span class="op">[</span><span class="va">pairs</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">themedian</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">pvalue</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">themedian</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">result.matrix</span><span class="op">[</span> ,<span class="va">i</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">themedian</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>, </span>
<span>         breaks<span class="op">=</span><span class="fl">30</span>, xlab<span class="op">=</span><span class="st">"Estimated difference"</span>,</span>
<span>         main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Bootstrap test of equality of two density estimates"</span>,</span>
<span>                    <span class="st">"\nMedian difference="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">themedian</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>                    <span class="st">" Two-tailed P-value="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pvalue</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">themedian</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">result.matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">first</span> <span class="op">&lt;-</span> <span class="va">pairs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">second</span> <span class="op">&lt;-</span> <span class="va">pairs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">line1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span><span class="op">[</span><span class="fu">.</span><span class="op">(</span><span class="va">strata.names</span><span class="op">[</span><span class="va">first</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">d.point.ests</span><span class="op">[</span><span class="va">first</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">line2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span><span class="op">[</span><span class="fu">.</span><span class="op">(</span><span class="va">strata.names</span><span class="op">[</span><span class="va">second</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">d.point.ests</span><span class="op">[</span><span class="va">second</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">as.expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">line1</span>, <span class="va">line2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>medians<span class="op">=</span><span class="va">themedian</span>, ps<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="va">pvalue</span>, thematrix<span class="op">=</span><span class="va">result.matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Several examples of the use of <code>differences.bootstrap</code> are provided. They make use of data sets that are included in the Distance package.</p>
<div class="section level3">
<h3 id="two-strata-with-pooled-detection-function">Two strata with pooled detection function<a class="anchor" aria-label="anchor" href="#two-strata-with-pooled-detection-function"></a>
</h3>
<p>The simplest example uses the <code>minke</code> data set that consists of two geographic strata (North and South). A model that can be fitted to these data assumes the two strata share a common detection function</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/Distance/" class="external-link">Distance</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">minke</span><span class="op">)</span></span>
<span><span class="va">hr.pooled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">minke</span>, key<span class="op">=</span><span class="st">"hr"</span>, truncation<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">differences.bootstrap</span><span class="op">(</span><span class="va">hr.pooled</span>, flatfile<span class="op">=</span><span class="va">minke</span>, nboot<span class="op">=</span><span class="fl">250</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:pooled"></span>
<img src="differences_files/figure-html/pooled-1.png" alt="Strata share a pooled detection function."><p class="caption">
Figure 1: Strata share a pooled detection function.
</p>
</div>
<p>Output from the function consists primarily of a histogram of the replicate density differences. This approximates the sampling distribution of the estimated density difference. A solid vertical line depicts the median of that distribution (medians are less influenced by outliers than are means). Dotted vertical lines depict the 95<sup>th</sup> percentiles around the estimated difference. The two-tailed P-value is presented in the histogram main title. In the legend box are presented the density estimates from the two strata, labelled using the <code>Region.Label</code> values found in the <code>dsmodel</code> object passed to the function.</p>
</div>
<div class="section level3">
<h3 id="two-strata-with-stratum-as-covariate">Two strata with stratum as covariate<a class="anchor" aria-label="anchor" href="#two-strata-with-stratum-as-covariate"></a>
</h3>
<p>Working with the same <code>minke</code> data set, we present an alternative analysis in which stratum-specific detection functions are derived using stratum as a covariate in the detection function. Having fitted that detection function model to the data, the comparison of the densities in the strata are performed using the same function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hr.covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">minke</span>, key<span class="op">=</span><span class="st">"hr"</span>, truncation<span class="op">=</span><span class="fl">1.5</span>, formula<span class="op">=</span><span class="op">~</span><span class="va">Region.Label</span><span class="op">)</span></span>
<span><span class="va">resultcovar</span> <span class="op">&lt;-</span> <span class="fu">differences.bootstrap</span><span class="op">(</span><span class="va">hr.covar</span>, flatfile<span class="op">=</span><span class="va">minke</span>, nboot<span class="op">=</span><span class="fl">250</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:two-covar"></span>
<img src="differences_files/figure-html/two-covar-1.png" alt="Two strata with Region.Label as a covariate in detection function."><p class="caption">
Figure 2: Two strata with Region.Label as a covariate in detection function.
</p>
</div>
<p>The evidence that densities differ in the two strata appear stronger in this analysis because the dependence in the two estimates is reduced as a result of stratum-specific detection functions being used. Of course, inference would not be drawn from two different analyses of the same data set, this is merely to demonstrate the use of the function. If we were to perform model selection upon the two detection function models fitted to the minke data, we would find the model with stratum as a covariate is preferable and our inference should be based upon this second analysis.</p>
</div>
<div class="section level3">
<h3 id="three-strata-with-stratum-as-covariate">Three strata with stratum as covariate<a class="anchor" aria-label="anchor" href="#three-strata-with-stratum-as-covariate"></a>
</h3>
<p>Another data set, <code>Savannah_sparrow_1980</code>, is derived from a point transect survey of a study area with three strata. We will fit a model with stratum as a covariate and send the result to our function to assess whether there are differences between the three strata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Savannah_sparrow_1980"</span><span class="op">)</span></span>
<span><span class="va">hn.sparrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/ds.html">ds</a></span><span class="op">(</span><span class="va">Savannah_sparrow_1980</span>, transect<span class="op">=</span><span class="st">"point"</span>, key<span class="op">=</span><span class="st">"hn"</span>, truncation<span class="op">=</span><span class="st">"10%"</span>, </span>
<span>                 convert_units<span class="op">=</span><span class="fu"><a href="../../../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="st">"meter"</span>, <span class="cn">NULL</span>, <span class="st">"hectare"</span><span class="op">)</span>, formula<span class="op">=</span><span class="op">~</span><span class="va">Region.Label</span><span class="op">)</span></span>
<span><span class="va">resultsparrow</span> <span class="op">&lt;-</span> <span class="fu">differences.bootstrap</span><span class="op">(</span><span class="va">hn.sparrow</span>, </span>
<span>                                       flatfile<span class="op">=</span><span class="va">Savannah_sparrow_1980</span>, </span>
<span>                                       nboot<span class="op">=</span><span class="fl">250</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:sparrow"></span>
<img src="differences_files/figure-html/sparrow-1.png" alt="Two strata with Region.Label as a covariate in detection function."><p class="caption">
Figure 3: Two strata with Region.Label as a covariate in detection function.
</p>
</div>
<p>Note here, when there are three strata, there are three pairwise comparisons. The function can cope with any number of strata, but recognise the number of comparisons (hence number of histograms) grows rapidly when the number of strata exceeds roughly 5.</p>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>This function cannot compute significance of density estimate differences when estimation is carried out via multiple calls to <code><a href="../../../reference/ds.html">ds()</a></code>, as would be the case when analysing data from different study areas residing in different data files. However, based upon the provided code, it should be clear how to produce replicate density estimates via <code><a href="../../../reference/bootdht.html">bootdht()</a></code> and then difference them with a single line of code. Depending upon circumstances, it might also be possible to combine the two data sets into a single data file and treat them as strata which could allow use of the provided function.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-buckland2001" class="csl-entry">
Buckland, S. T., Anderson, D. R., Burnham, K. P., Laake, J. L., Borchers, D. L., &amp; Thomas, L. (2001). <em>Introduction to distance sampling: Estimating abundance of biological populations</em>. Oxford, New York: Oxford University Press.
</div>
<div id="ref-miller2019" class="csl-entry">
Miller, D. L., Rexstad, E., Thomas, L., Marshall, L., &amp; Laake, J. L. (2019). Distance Sampling in <span>R</span>. <em>Journal of Statistical Software</em>, <em>89</em>(1), 1â€“28. <a href="https://doi.org/10.18637/jss.v089.i01" class="external-link">https://doi.org/10.18637/jss.v089.i01</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer>
</div>





  </body>
</html>
