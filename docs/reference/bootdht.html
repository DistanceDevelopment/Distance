<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bootstrap uncertainty estimation for distance sampling models — bootdht • Distance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrap uncertainty estimation for distance sampling models — bootdht"><meta name="description" content="Performs a bootstrap for simple distance sampling models using the same data
structures as dht. Note that only geographical stratification
as supported in dht is allowed."><meta property="og:description" content="Performs a bootstrap for simple distance sampling models using the same data
structures as dht. Note that only geographical stratification
as supported in dht is allowed."><script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;   y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "m9rbql4acz");</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Distance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Function reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/lines-distill.html">Line transects</a></li>
    <li><a class="dropdown-item" href="../articles/covariates-distill.html">Covariates in detection</a></li>
    <li><a class="dropdown-item" href="../articles/species-covariate-distill.html">Species as a covariate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Only for the website</h6></li>
    <li><a class="dropdown-item" href="../articles/web-only/points/pointtransects-distill.html">Point transects</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/groupsize/Remedy-size-bias-for-dolphin-surveys.html">Size bias remedy</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/strata/strata-distill.html">Stratification</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/differences/differences.html">Detecting difference in density between strata</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/variance/variance-distill.html">Variance estimation with bootstrap</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/cues/cuecounts-distill.html">Cue count surveys</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/multipliers/multipliers-distill.html">Indirect surveys</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/multispecies/multispecies-multioccasion-analysis.html">Take care when subsetting multispecies data sets</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/CTDS/camera-distill.html">Camera trap distance sampling</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/alt-optimise/mcds-dot-exe.html">Alternative optimiser</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/Distance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bootstrap uncertainty estimation for distance sampling models</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/Distance/blob/HEAD/R/bootdht.R" class="external-link"><code>R/bootdht.R</code></a></small>
      <div class="d-none name"><code>bootdht.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs a bootstrap for simple distance sampling models using the same data
structures as <code><a href="https://rdrr.io/pkg/mrds/man/dht.html" class="external-link">dht</a></code>. Note that only geographical stratification
as supported in <code>dht</code> is allowed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bootdht</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">flatfile</span>,</span>
<span>  resample_strata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  resample_obs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  resample_transects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  summary_fun <span class="op">=</span> <span class="va">bootdht_Nhat_summarize</span>,</span>
<span>  convert_units <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  select_adjustments <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample_fraction <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  multipliers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progress_bar <span class="op">=</span> <span class="st">"base"</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  convert.units <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>a model fitted by <code><a href="ds.html">ds</a></code> or a list of models</p></dd>


<dt id="arg-flatfile">flatfile<a class="anchor" aria-label="anchor" href="#arg-flatfile"></a></dt>
<dd><p>Data provided in the flatfile format. See <code><a href="flatfile.html">flatfile</a></code> for
details. Please note, it is a current limitation of bootdht that all
Sample.Label identifiers must be unique across all strata, i.e.transect
ids must not be re-used from one strata to another. An easy way to achieve
this is to paste together the stratum names and transect ids.</p></dd>


<dt id="arg-resample-strata">resample_strata<a class="anchor" aria-label="anchor" href="#arg-resample-strata"></a></dt>
<dd><p>should resampling happen at the stratum
(<code>Region.Label</code>) level? (Default <code>FALSE</code>)</p></dd>


<dt id="arg-resample-obs">resample_obs<a class="anchor" aria-label="anchor" href="#arg-resample-obs"></a></dt>
<dd><p>should resampling happen at the observation (<code>object</code>)
level? (Default <code>FALSE</code>)</p></dd>


<dt id="arg-resample-transects">resample_transects<a class="anchor" aria-label="anchor" href="#arg-resample-transects"></a></dt>
<dd><p>should resampling happen at the transect
(<code>Sample.Label</code>) level? (Default <code>TRUE</code>)</p></dd>


<dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>number of bootstrap replicates</p></dd>


<dt id="arg-summary-fun">summary_fun<a class="anchor" aria-label="anchor" href="#arg-summary-fun"></a></dt>
<dd><p>function that is used to obtain summary statistics from
the bootstrap, see Summary Functions below. By default
<code><a href="bootdht_Nhat_summarize.html">bootdht_Nhat_summarize</a></code> is used, which just extracts abundance estimates.</p></dd>


<dt id="arg-convert-units">convert_units<a class="anchor" aria-label="anchor" href="#arg-convert-units"></a></dt>
<dd><p>conversion between units for abundance estimation, see
"Units", below. (Defaults to 1, implying all of the units are "correct"
already.) This takes precedence over any unit conversion stored in <code>model</code>.</p></dd>


<dt id="arg-select-adjustments">select_adjustments<a class="anchor" aria-label="anchor" href="#arg-select-adjustments"></a></dt>
<dd><p>select the number of adjustments in each
bootstrap, when <code>FALSE</code> the exact detection function specified in <code>model</code> is
fitted to each replicate. Setting this option to <code>TRUE</code> can significantly
increase the runtime for the bootstrap. Note that for this to work <code>model</code>
must have been fitted with <code>adjustment!=NULL</code>.</p></dd>


<dt id="arg-sample-fraction">sample_fraction<a class="anchor" aria-label="anchor" href="#arg-sample-fraction"></a></dt>
<dd><p>what proportion of the transects was covered (e.g.,
0.5 for one-sided line transects).</p></dd>


<dt id="arg-multipliers">multipliers<a class="anchor" aria-label="anchor" href="#arg-multipliers"></a></dt>
<dd><p><code>list</code> of multipliers. See "Multipliers" below.</p></dd>


<dt id="arg-progress-bar">progress_bar<a class="anchor" aria-label="anchor" href="#arg-progress-bar"></a></dt>
<dd><p>which progress bar should be used? Default "base" uses
<code>txtProgressBar</code>, "none" suppresses output, "progress" uses the
<code>progress</code> package, if installed.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>number of CPU cores to use to compute the estimates. See "Parallelization" below.</p></dd>


<dt id="arg-convert-units">convert.units<a class="anchor" aria-label="anchor" href="#arg-convert-units"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="summary-functions">Summary Functions<a class="anchor" aria-label="anchor" href="#summary-functions"></a></h2>


<p>The function <code>summary_fun</code> allows the user to specify what summary
statistics should be recorded from each bootstrap. The function should take
two arguments, <code>ests</code> and <code>fit</code>. The former is the output from
<code>dht2</code>, giving tables of estimates. The latter is the fitted detection
function object. The function is called once fitting and estimation has been
performed and should return a <code>data.frame</code>. Those <code>data.frame</code>s
are then concatenated using <code>rbind</code>. One can make these functions
return any information within those objects, for example abundance or
density estimates or the AIC for each model. See Examples below.</p>
    </div>
    <div class="section level2">
    <h2 id="multipliers">Multipliers<a class="anchor" aria-label="anchor" href="#multipliers"></a></h2>


<p>It is often the case that we cannot measure distances to individuals or
groups directly, but instead need to estimate distances to something they
produce (e.g., for whales, their blows; for elephants their dung) – this is
referred to as indirect sampling. We may need to use estimates of production
rate and decay rate for these estimates (in the case of dung or nests) or
just production rates (in the case of songbird calls or whale blows). We
refer to these conversions between "number of cues" and "number of animals"
as "multipliers".</p>
<p>The <code>multipliers</code> argument is a <code>list</code>, with 3 possible elements (<code>creation</code>
and <code>decay</code>). Each element of which is either:</p><ul><li><p><code>data.frame</code> and must have at least a column named <code>rate</code>, which abundance
estimates will be divided by (the term "multiplier" is a misnomer, but
kept for compatibility with Distance for Windows). Additional columns can
be added to give the standard error and degrees of freedom for the rate
if known as <code>SE</code> and <code>df</code>, respectively. You can use a multirow
<code>data.frame</code> to have different rates for different geographical areas
(for example). In this case the rows need to have a column (or columns)
to <code>merge</code> with the data (for example <code>Region.Label</code>).</p></li>
<li><p>a <code>function</code> which will return a single estimate of the relevant
multiplier. See <code><a href="make_activity_fn.html">make_activity_fn</a></code> for a helper function for use with the
<code>activity</code> package.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a></h2>


<p>Model selection can be performed on a per-replicate basis within the
bootstrap. This has three variations:</p><ol><li><p>when <code>select_adjustments</code> is <code>TRUE</code> then adjustment terms are selected
by AIC within each bootstrap replicate (provided that <code>model</code> had the
<code>order</code> and <code>adjustment</code> options set to non-<code>NULL</code>.</p></li>
<li><p>if <code>model</code> is a list of fitted detection functions, each of these is
fitted to each replicate and results generated from the one with the
lowest AIC.</p></li>
<li><p>when <code>select_adjustments</code> is <code>TRUE</code> and <code>model</code> is a list of fitted
detection functions, each model fitted to each replicate and number of
adjustments is selected via AIC.
This last option can be extremely time consuming.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a></h2>


<p>If <code>cores</code>&gt;1 then the <code>parallel</code>/<code>doParallel</code>/<code>foreach</code>/<code>doRNG</code> packages
will be used to run the computation over multiple cores of the computer. To
use this component you need to install those packages using:
<code>install.packages(c("foreach", "doParallel", "doRNG"))</code> It is advised that
you do not set <code>cores</code> to be greater than one less than the number of cores
on your machine. The <code>doRNG</code> package is required to make analyses
reproducible (<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></code> can be used to ensure the same answers).</p>
<p>It is also hard to debug any issues in <code>summary_fun</code> so it is best to run a
small number of bootstraps first in parallel to check that things work. On
Windows systems <code>summary_fun</code> does not have access to the global environment
when running in parallel, so all computations must be made using only its
<code>ests</code> and <code>fit</code> arguments (i.e., you can not use R objects from elsewhere
in that function, even if they are available to you from the console).</p>
<p>Another consequence of the global environment being unavailable inside
parallel bootstraps is that any starting values in the model object passed
in to <code>bootdht</code> must be hard coded (otherwise you get back 0 successful
bootstraps). For a worked example showing this, see the camera trap distance
sampling online example at
<a href="https://examples.distancesampling.org/Distance-cameratraps/camera-distill.html" class="external-link">https://examples.distancesampling.org/Distance-cameratraps/camera-distill.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="summary.dht_bootstrap.html">summary.dht_bootstrap</a></code> for how to summarize the results,
<code><a href="bootdht_Nhat_summarize.html">bootdht_Nhat_summarize</a></code> and <code><a href="bootdht_Dhat_summarize.html">bootdht_Dhat_summarize</a></code> for an examples of
summary functions.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># fit a model to the minke data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">minke</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="ds.html">ds</a></span><span class="op">(</span><span class="va">minke</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary function to save the abundance estimate</span></span></span>
<span class="r-in"><span><span class="va">Nhat_summarize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ests</span>, <span class="va">fit</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Nhat<span class="op">=</span><span class="va">ests</span><span class="op">$</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">Estimate</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform 5 bootstraps</span></span></span>
<span class="r-in"><span><span class="va">bootout</span> <span class="op">&lt;-</span> <span class="fu">bootdht</span><span class="op">(</span><span class="va">mod1</span>, flatfile<span class="op">=</span><span class="va">minke</span>, summary_fun<span class="op">=</span><span class="va">Nhat_summarize</span>, nboot<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># obtain basic summary information</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bootout</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

