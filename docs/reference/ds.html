<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit detection functions and calculate abundance from line or point transect data — ds • Distance</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit detection functions and calculate abundance from line or point transect data — ds"><meta name="description" content="This function fits detection functions to line or point transect data and
then (provided that survey information is supplied) calculates abundance and
density estimates. The examples below illustrate some basic types of
analysis using ds()."><meta property="og:description" content="This function fits detection functions to line or point transect data and
then (provided that survey information is supplied) calculates abundance and
density estimates. The examples below illustrate some basic types of
analysis using ds()."><script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;   y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "m9rbql4acz");</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Distance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Function reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/lines-distill.html">Line transects</a></li>
    <li><a class="dropdown-item" href="../articles/covariates-distill.html">Covariates in detection</a></li>
    <li><a class="dropdown-item" href="../articles/species-covariate-distill.html">Species as a covariate</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Only for the website</h6></li>
    <li><a class="dropdown-item" href="../articles/web-only/points/pointtransects-distill.html">Point transects</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/groupsize/Remedy-size-bias-for-dolphin-surveys.html">Size bias remedy</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/strata/strata-distill.html">Stratification</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/differences/differences.html">Detecting difference in density between strata</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/variance/variance-distill.html">Variance estimation with bootstrap</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/cues/cuecounts-distill.html">Cue count surveys</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/multipliers/multipliers-distill.html">Indirect surveys</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/multispecies/multispecies-multioccasion-analysis.html">Take care when subsetting multispecies data sets</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/CTDS/camera-distill.html">Camera trap distance sampling</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/alt-optimise/mcds-dot-exe.html">Alternative optimiser</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/predict_detprob/predicting_detection_probabilities.html">Predict detection probabilities</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/Distance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit detection functions and calculate abundance from line or point transect data</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/Distance/blob/HEAD/R/ds.R" class="external-link"><code>R/ds.R</code></a></small>
      <div class="d-none name"><code>ds.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function fits detection functions to line or point transect data and
then (provided that survey information is supplied) calculates abundance and
density estimates. The examples below illustrate some basic types of
analysis using <code>ds()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ds</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cutpoints</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">distend</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">distend</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cutpoints</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  transect <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>  formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span>, <span class="st">"hr"</span>, <span class="st">"unif"</span><span class="op">)</span>,</span>
<span>  adjustment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cos"</span>, <span class="st">"herm"</span>, <span class="st">"poly"</span><span class="op">)</span>,</span>
<span>  nadj <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"width"</span>, <span class="st">"scale"</span><span class="op">)</span>,</span>
<span>  cutpoints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dht_group <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  monotonicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">formula</span> <span class="op">==</span> <span class="op">~</span><span class="fl">1</span>, <span class="st">"strict"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  region_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  obs_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  convert_units <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  er_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">transect</span> <span class="op">==</span> <span class="st">"line"</span>, <span class="st">"R2"</span>, <span class="st">"P2"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"nlminb"</span>,</span>
<span>  mono_method <span class="op">=</span> <span class="st">"slsqp"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debug_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  initial_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_adjustments <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  er_method <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dht_se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  winebin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">dht.group</span>,</span>
<span>  <span class="va">region.table</span>,</span>
<span>  <span class="va">sample.table</span>,</span>
<span>  <span class="va">obs.table</span>,</span>
<span>  <span class="va">convert.units</span>,</span>
<span>  <span class="va">er.var</span>,</span>
<span>  <span class="va">debug.level</span>,</span>
<span>  <span class="va">initial.values</span>,</span>
<span>  <span class="va">max.adjustments</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a <code>data.frame</code> containing at least a column called <code>distance</code> or
a numeric vector containing the distances.  NOTE!  If there is a column
called <code>size</code> in the data then it will be interpreted as group/cluster size,
see the section "Clusters/groups", below. One can supply data as a "flat
file" and not supply <code>region_table</code>, <code>sample_table</code> and <code>obs_table</code>, see
"Data format", below and <code><a href="flatfile.html">flatfile</a></code>.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>either truncation distance (numeric, e.g. 5) or percentage
(as a string, e.g. "15%"). Can be supplied as a <code>list</code> with elements <code>left</code>
and <code>right</code> if left truncation is required (e.g.  <code>list(left=1,right=20)</code> or
<code>list(left="1%",right="15%")</code> or even <code>list(left="1",right="15%")</code>).  By
default for exact distances the maximum observed distance is used as the
right truncation. When the data is binned, the right truncation is the
largest bin end point. Default left truncation is set to zero.</p></dd>


<dt id="arg-transect">transect<a class="anchor" aria-label="anchor" href="#arg-transect"></a></dt>
<dd><p>indicates transect type "line" (default) or "point".</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>formula for the scale parameter. For a CDS analysis leave
this as its default <code>~1</code>.</p></dd>


<dt id="arg-key">key<a class="anchor" aria-label="anchor" href="#arg-key"></a></dt>
<dd><p>key function to use; <code>"hn"</code> gives half-normal (default), <code>"hr"</code>
gives hazard-rate and <code>"unif"</code> gives uniform. Note that if uniform key is
used, covariates cannot be included in the model.</p></dd>


<dt id="arg-adjustment">adjustment<a class="anchor" aria-label="anchor" href="#arg-adjustment"></a></dt>
<dd><p>adjustment terms to use; <code>"cos"</code> gives cosine (default),
<code>"herm"</code> gives Hermite polynomial and <code>"poly"</code> gives simple polynomial. A
value of <code>NULL</code> indicates that no adjustments are to be fitted.</p></dd>


<dt id="arg-nadj">nadj<a class="anchor" aria-label="anchor" href="#arg-nadj"></a></dt>
<dd><p>the number of adjustment terms to fit. In the absence of
covariates in the formula, the default value (<code>NULL</code>) will select via AIC
(using a sequential forward selection algorithm) up to <code>max.adjustment</code>
adjustments (unless <code>order</code> is specified). When covariates are present
in the model formula, the default value of <code>NULL</code> results in no adjustment
terms being fitted in the model. A non-negative integer value will cause
the specified number of adjustments to be fitted. Supplying an integer
value will allow the use of adjustment terms in addition to specifying
covariates in the model. The order of adjustment terms used will depend
on the <code>key</code>and <code>adjustment</code>. For <code>key="unif"</code>, adjustments of order
1, 2, 3, ... are fitted when <code>adjustment = "cos"</code> and order 2, 4, 6, ...
otherwise. For <code>key="hn"</code> or <code>"hr"</code> adjustments of order 2, 3, 4, ... are
fitted when <code>adjustment = "cos"</code> and order 4, 6, 8, ... otherwise. See
Buckland et al. (2001)
 p. 47 for details.</p></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>order of adjustment terms to fit. The default value (<code>NULL</code>)
results in <code>ds</code> choosing the orders to use - see <code>nadj</code>. Otherwise a scalar
positive integer value can be used to fit a single adjustment term of the
specified order, and a vector of positive integers to fit multiple
adjustment terms of the specified orders. For simple and Hermite polynomial
adjustments, only even orders are allowed. The number of adjustment terms
specified here must match <code>nadj</code> (or <code>nadj</code> can be the default <code>NULL</code> value).</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>the scale by which the distances in the adjustment terms are
divided. Defaults to <code>"width"</code>, scaling by the truncation distance. If the
key is uniform only <code>"width"</code> will be used. The other option is <code>"scale"</code>:
the scale parameter of the detection</p></dd>


<dt id="arg-cutpoints">cutpoints<a class="anchor" aria-label="anchor" href="#arg-cutpoints"></a></dt>
<dd><p>if the data are binned, this vector gives the cutpoints of
the bins. Supplying a distance column in your data and specifying cutpoints
is the recommended approach for all standard binned analyses.
Ensure that the first element is 0 (or the left truncation
distance) and the last is the distance to the end of the furthest bin.
(Default <code>NULL</code>, no binning.) If you have provided <code>distbegin</code> and <code>distend</code>
columns in your data (note this should only be used when your cutpoints
are not constant across all your data, e.g. planes flying at differing
altitudes) then do not specify the cutpoints argument as this will cause
the <code>distbegin</code> and <code>distend</code> columns in your data to be overwritten.</p></dd>


<dt id="arg-dht-group">dht_group<a class="anchor" aria-label="anchor" href="#arg-dht-group"></a></dt>
<dd><p>should density abundance estimates consider all groups to
be size 1 (abundance of groups) <code>dht_group=TRUE</code> or should the abundance of
individuals (group size is taken into account), <code>dht_group=FALSE</code>. Default
is <code>FALSE</code> (abundance of individuals is calculated).</p></dd>


<dt id="arg-monotonicity">monotonicity<a class="anchor" aria-label="anchor" href="#arg-monotonicity"></a></dt>
<dd><p>should the detection function be constrained for
monotonicity weakly (<code>"weak"</code>), strictly (<code>"strict"</code>) or not at all
(<code>"none"</code> or <code>FALSE</code>). See Monotonicity, below. (Default <code>"strict"</code>). By
default it is on for models without covariates in the detection function,
off when covariates are present.</p></dd>


<dt id="arg-region-table">region_table<a class="anchor" aria-label="anchor" href="#arg-region-table"></a></dt>
<dd><p><code>data_frame</code> with two columns:</p><ul><li><p><code>Region.Label</code> label for the region</p></li>
<li><p><code>Area</code> area of the region</p></li>
<li><p><code>region_table</code> has one row for each stratum. If there is no
stratification then <code>region_table</code> has one entry with <code>Area</code> corresponding
to the total survey area. If <code>Area</code> is omitted density estimates only are
produced.</p></li>
</ul></dd>


<dt id="arg-sample-table">sample_table<a class="anchor" aria-label="anchor" href="#arg-sample-table"></a></dt>
<dd><p><code>data.frame</code> mapping the regions to the samples
(i.e. transects). There are three columns:</p><ul><li><p><code>Sample.Label</code> label for the sample</p></li>
<li><p><code>Region.Label</code> label for the region that the sample belongs to.</p></li>
<li><p><code>Effort</code> the effort expended in that sample (e.g. transect length).</p></li>
</ul></dd>


<dt id="arg-obs-table">obs_table<a class="anchor" aria-label="anchor" href="#arg-obs-table"></a></dt>
<dd><p><code>data.frame</code> mapping the individual observations
(objects) to regions and samples. There should be three columns:</p><ul><li><p><code>object</code> unique numeric identifier for the observation</p></li>
<li><p><code>Region.Label</code> label for the region that the sample belongs to</p></li>
<li><p><code>Sample.Label</code> label for the sample</p></li>
</ul></dd>


<dt id="arg-convert-units">convert_units<a class="anchor" aria-label="anchor" href="#arg-convert-units"></a></dt>
<dd><p>conversion between units for abundance estimation, see
"Units", below. (Defaults to 1, implying all of the units are "correct"
already.)</p></dd>


<dt id="arg-er-var">er_var<a class="anchor" aria-label="anchor" href="#arg-er-var"></a></dt>
<dd><p>specifies which encounter rate estimator to use in the case
that dht_se is TRUE, er_method is either 1 or 2 and there are two or more
samplers. Defaults to "R2" for line transects and "P2" for point transects
(&gt;= 1.0.9, earlier versions &lt;= 1.0.8 used the "P3" estimator by default
for points), both of which assume random placement of transects. For
systematic designs, alternative estimators may be more appropriate,
see <code><a href="dht2.html">dht2</a></code> for more information.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>optimization method to use (any method usable by
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> or <code><a href="https://rdrr.io/pkg/optimx/man/optimx.html" class="external-link">optimx</a></code>). Defaults to
<code>"nlminb"</code>.</p></dd>


<dt id="arg-mono-method">mono_method<a class="anchor" aria-label="anchor" href="#arg-mono-method"></a></dt>
<dd><p>optimization method to use when monotonicity is enforced.
Can be either <code>slsqp</code> or <code>solnp</code>. Defaults to <code>slsqp</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>suppress non-essential messages (useful for bootstraps etc).
Default value <code>FALSE</code>.</p></dd>


<dt id="arg-debug-level">debug_level<a class="anchor" aria-label="anchor" href="#arg-debug-level"></a></dt>
<dd><p>print debugging output. <code>0</code>=none, <code>1-3</code> increasing levels
of debugging output.</p></dd>


<dt id="arg-initial-values">initial_values<a class="anchor" aria-label="anchor" href="#arg-initial-values"></a></dt>
<dd><p>a <code>list</code> of named starting values, see
<code><a href="https://rdrr.io/pkg/mrds/man/mrds_opt.html" class="external-link">mrds_opt</a></code>. Only allowed when AIC term selection is not
used.</p></dd>


<dt id="arg-max-adjustments">max_adjustments<a class="anchor" aria-label="anchor" href="#arg-max-adjustments"></a></dt>
<dd><p>maximum number of adjustments to try (default 5) only
used when <code>order=NULL</code>.</p></dd>


<dt id="arg-er-method">er_method<a class="anchor" aria-label="anchor" href="#arg-er-method"></a></dt>
<dd><p>encounter rate variance calculation: default = 2 gives the
method of Innes et al. (2002)
, using expected counts in the encounter rate. Setting
to 1 gives observed counts (which matches Distance for Windows) and 0 uses
negative binomial variance (only useful in the rare situation where study area =
surveyed area).
See <code><a href="https://rdrr.io/pkg/mrds/man/dht.se.html" class="external-link">dht.se</a></code> for more details, noting this <code>er_method</code>
argument corresponds to the <code>varflag</code> element of the <code>options</code>
argument in <code>dht.se</code>.</p></dd>


<dt id="arg-dht-se">dht_se<a class="anchor" aria-label="anchor" href="#arg-dht-se"></a></dt>
<dd><p>should uncertainty be calculated when using <code>dht</code>? Safe to
leave as <code>TRUE</code>, used in <code>bootdht</code>.</p></dd>


<dt id="arg-optimizer">optimizer<a class="anchor" aria-label="anchor" href="#arg-optimizer"></a></dt>
<dd><p>By default this is set to 'both'. In this case
the R optimizer will be used and if present the MCDS optimizer will also
be used. The result with the best likelihood value will be selected. To
run only a specified optimizer set this value to either 'R' or 'MCDS'.
See <code><a href="https://rdrr.io/pkg/mrds/man/mcds_dot_exe.html" class="external-link">mcds_dot_exe</a></code> for setup instructions.</p></dd>


<dt id="arg-winebin">winebin<a class="anchor" aria-label="anchor" href="#arg-winebin"></a></dt>
<dd><p>If you are trying to use our MCDS.exe optimizer on a
non-windows system then you may need to specify the winebin. Please
see <code><a href="https://rdrr.io/pkg/mrds/man/mcds_dot_exe.html" class="external-link">mcds_dot_exe</a></code> for more details.</p></dd>


<dt id="arg-dht-group">dht.group<a class="anchor" aria-label="anchor" href="#arg-dht-group"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-region-table">region.table<a class="anchor" aria-label="anchor" href="#arg-region-table"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-sample-table">sample.table<a class="anchor" aria-label="anchor" href="#arg-sample-table"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-obs-table">obs.table<a class="anchor" aria-label="anchor" href="#arg-obs-table"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-convert-units">convert.units<a class="anchor" aria-label="anchor" href="#arg-convert-units"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-er-var">er.var<a class="anchor" aria-label="anchor" href="#arg-er-var"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-debug-level">debug.level<a class="anchor" aria-label="anchor" href="#arg-debug-level"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-initial-values">initial.values<a class="anchor" aria-label="anchor" href="#arg-initial-values"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>


<dt id="arg-max-adjustments">max.adjustments<a class="anchor" aria-label="anchor" href="#arg-max-adjustments"></a></dt>
<dd><p>deprecated, see same argument with underscore, above.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with elements:</p><ul><li><p><code>ddf</code> a detection function model object.</p></li>
<li><p><code>dht</code> abundance/density information (if survey region data was supplied,
else <code>NULL</code>)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>If abundance estimates are required then the <code>data.frame</code>s <code>region_table</code>
and <code>sample_table</code> must be supplied. If <code>data</code> does not contain the columns
<code>Region.Label</code> and <code>Sample.Label</code> then the <code>data.frame</code> <code>obs_table</code> must
also be supplied. Note that stratification only applies to abundance
estimates and not at the detection function level. Density and abundance
estimates, and corresponding estimates of variance and confidence intervals,
are calculated using the methods described in Buckland et al. (2001)

sections 3.6.1 and 3.7.1 (further details can be found in the documentation
for <code><a href="https://rdrr.io/pkg/mrds/man/dht.html" class="external-link">dht</a></code>).</p>
<p>For more advanced abundance/density estimation please see the
<code><a href="https://rdrr.io/pkg/mrds/man/dht.html" class="external-link">dht</a></code> and <code><a href="dht2.html">dht2</a></code> functions.</p>
<p>Examples of distance sampling analyses are available at
<a href="https://distancesampling.org/resources/vignettes.html" class="external-link">https://distancesampling.org/resources/vignettes.html</a>.</p>
<p>Hints and tips on fitting (particularly optimisation issues) are on the
<code><a href="https://rdrr.io/pkg/mrds/man/mrds_opt.html" class="external-link">mrds_opt</a></code> manual page.</p>
    </div>
    <div class="section level2">
    <h2 id="clusters-groups">Clusters/groups<a class="anchor" aria-label="anchor" href="#clusters-groups"></a></h2>


<p>Note that if the data contains a column named <code>size</code>, cluster size will be
estimated and density/abundance will be based on a clustered analysis of
the data. Setting this column to be <code>NULL</code> will perform a non-clustered
analysis (for example if "<code>size</code>" means something else in your dataset).</p>
    </div>
    <div class="section level2">
    <h2 id="truncation">Truncation<a class="anchor" aria-label="anchor" href="#truncation"></a></h2>


<p>The right truncation point is by default set to be largest observed distance
or bin end point. This is a default will not be appropriate for all data and
can often be the cause of model convergence failures. It is recommended that
one plots a histogram of the observed distances prior to model fitting so as
to get a feel for an appropriate truncation distance. (Similar arguments go
for left truncation, if appropriate). Buckland et al. (2001)
 provide
guidelines on truncation.</p>
<p>When specified as a percentage, the largest <code>right</code> and smallest <code>left</code>
percent distances are discarded. Percentages cannot be supplied when using
binned data.</p>
<p>For left truncation, there are two options: (1) fit a detection function to
the truncated data as is (this is what happens when you set <code>left</code>).  This
does not assume that g(x)=1 at the truncation point. (2) manually remove
data with distances less than the left truncation distance – effectively
move the centre line out to be the truncation distance (this needs to be
done before calling <code>ds</code>). This then assumes that detection is certain at
the left truncation distance. The former strategy has a weaker assumption,
but will give higher variance as the detection function close to the line
has no data to tell it where to fit – it will be relying on the data from
after the left truncation point and the assumed shape of the detection
function. The latter is most appropriate in the case of aerial surveys,
where some area under the plane is not visible to the observers, but their
probability of detection is certain at the smallest distance.</p>
    </div>
    <div class="section level2">
    <h2 id="binning">Binning<a class="anchor" aria-label="anchor" href="#binning"></a></h2>


<p>Note that binning is performed such that bin 1 is all distances greater or
equal to cutpoint 1 (&gt;=0 or left truncation distance) and less than cutpoint
2. Bin 2 is then distances greater or equal to cutpoint 2 and less than
cutpoint 3 and so on.</p>
    </div>
    <div class="section level2">
    <h2 id="monotonicity">Monotonicity<a class="anchor" aria-label="anchor" href="#monotonicity"></a></h2>


<p>When adjustment terms are used, it is possible for the detection function to
not always decrease with increasing distance. This is unrealistic and can
lead to bias. To avoid this, the detection function can be constrained for
monotonicity (and is by default for detection functions without covariates).</p>
<p>Monotonicity constraints are supported in a similar way to that described
in Buckland et al. (2001)
. 20 equally spaced points over
the range of the
detection function (left to right truncation) are evaluated at each round
of the optimisation and the function is constrained to be either always
less than it's value at zero (<code>"weak"</code>) or such that each value is
less than or equal to the previous point (monotonically decreasing;
<code>"strict"</code>). See also <code><a href="https://rdrr.io/pkg/mrds/man/check.mono.html" class="external-link">check.mono</a></code>.</p>
<p>Even with no monotonicity constraints, checks are still made that the
detection function is monotonic, see <code><a href="https://rdrr.io/pkg/mrds/man/check.mono.html" class="external-link">check.mono</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="units">Units<a class="anchor" aria-label="anchor" href="#units"></a></h2>


<p>In extrapolating to the entire survey region it is important that the unit
measurements be consistent or converted for consistency. A conversion
factor can be specified with the <code>convert_units</code> argument. The values of
<code>Area</code> in <code>region_table</code>, must be made consistent with the units for
<code>Effort</code> in <code>sample_table</code> and the units of <code>distance</code> in the <code>data.frame</code>
that was analyzed. It is easiest if the units of <code>Area</code> are the square of
the units of <code>Effort</code> and then it is only necessary to convert the units of
<code>distance</code> to the units of <code>Effort</code>. For example, if <code>Effort</code> was entered
in kilometres and <code>Area</code> in square kilometres and <code>distance</code> in metres then
using <code>convert_units=0.001</code> would convert metres to kilometres, density
would be expressed in square kilometres which would then be consistent with
units for <code>Area</code>. However, they can all be in different units as long as
the appropriate composite value for <code>convert_units</code> is chosen. Abundance
for a survey region can be expressed as: <code>A*N/a</code> where <code>A</code> is <code>Area</code> for
the survey region, <code>N</code> is the abundance in the covered (sampled) region,
and <code>a</code> is the area of the sampled region and is in units of <code>Effort * distance</code>. The sampled region <code>a</code> is multiplied by <code>convert_units</code>, so it
should be chosen such that the result is in the same units as <code>Area</code>.  For
example, if <code>Effort</code> was entered in kilometres, <code>Area</code> in hectares (100m x
100m) and <code>distance</code> in metres, then using <code>convert_units=10</code> will convert
<code>a</code> to units of hectares (100 to convert metres to 100 metres for distance
and .1 to convert km to 100m units).</p>
    </div>
    <div class="section level2">
    <h2 id="data-format">Data format<a class="anchor" aria-label="anchor" href="#data-format"></a></h2>


<p>One can supply <code>data</code> only to simply fit a detection function. However, if
abundance/density estimates are necessary further information is required.
Either the <code>region_table</code>, <code>sample_table</code> and <code>obs_table</code> <code>data.frame</code>s can
be supplied or all data can be supplied as a "flat file" in the <code>data</code>
argument. In this format each row in data has additional information that
would ordinarily be in the other tables. This usually means that there are
additional columns named: <code>Sample.Label</code>, <code>Region.Label</code>, <code>Effort</code> and
<code>Area</code> for each observation. See <code><a href="flatfile.html">flatfile</a></code> for an example.</p>
    </div>
    <div class="section level2">
    <h2 id="density-estimation">Density estimation<a class="anchor" aria-label="anchor" href="#density-estimation"></a></h2>


<p>If column <code>Area</code> is omitted, a density estimate is generated but note that
the degrees of freedom/standard errors/confidence intervals will not match
density estimates made with the <code>Area</code> column present.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Buckland ST, Anderson DR, Burnham KP, Laake JL, Borchers DL, Thomas L (2001).
<em>Introduction to distance sampling: estimating abundance of biological populations</em>.
Oxford university press.<br><br> Innes S, Heide-Jørgensen MP, Laake JL, Laidre KL, Cleator HJ, Richard P, Stewart RE (2002).
“Surveys of belugas and narwhals in the Canadian High Arctic in 1996.”
<em>NAMMCO Scientific Publications</em>, <b>4</b>, 169-190.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="flatfile.html">flatfile</a></code>, <code><a href="https://rdrr.io/pkg/mrds/man/AIC.ddf.html" class="external-link">AIC.ds</a></code>,
<code><a href="ds.gof.html">ds.gof</a></code>, <code><a href="p_dist_table.html">p_dist_table</a></code>,
<code><a href="https://rdrr.io/pkg/mrds/man/plot.ds.html" class="external-link">plot.ds</a></code>, <code><a href="add_df_covar_line.html">add_df_covar_line</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David L. Miller</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># An example from mrds, the golf tee data.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/Distance/" class="external-link">Distance</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">book.tee.data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tee.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">book.tee.data</span><span class="op">$</span><span class="va">book.tee.dataframe</span>, <span class="va">observer</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds.model</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting AIC adjustment term selection.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting half-normal key function</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> AIC= 311.138</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting half-normal key function with cosine(2) adjustments</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> AIC= 313.124</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Half-normal key function selected.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No survey area information supplied, only estimating detection function.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary for distance analysis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations :  124 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Distance range         :  0  -  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model       : Half-normal key function </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC         :  311.1385 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimisation:  mrds (nlminb) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection function parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scale coefficient(s):  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              estimate         se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 0.6632435 0.09981249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        Estimate          SE         CV</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average p             0.5842744  0.04637627 0.07937412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N in covered region 212.2290462 20.85130344 0.09824906</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ds.model</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ds-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># same model, but calculating abundance</span></span></span>
<span class="r-in"><span><span class="co"># need to supply the region, sample and observation tables</span></span></span>
<span class="r-in"><span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va">book.tee.data</span><span class="op">$</span><span class="va">book.tee.region</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">book.tee.data</span><span class="op">$</span><span class="va">book.tee.samples</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">book.tee.data</span><span class="op">$</span><span class="va">book.tee.obs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds.dht.model</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, <span class="fl">4</span>, region_table<span class="op">=</span><span class="va">region</span>,</span></span>
<span class="r-in"><span>                   sample_table<span class="op">=</span><span class="va">samples</span>, obs_table<span class="op">=</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.dht.model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify order 2 cosine adjustments</span></span></span>
<span class="r-in"><span><span class="va">ds.model.cos2</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, <span class="fl">4</span>, adjustment<span class="op">=</span><span class="st">"cos"</span>, order<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.model.cos2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify order 2 and 3 cosine adjustments, turning monotonicity</span></span></span>
<span class="r-in"><span><span class="co"># constraints off</span></span></span>
<span class="r-in"><span><span class="va">ds.model.cos23</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, <span class="fl">4</span>, adjustment<span class="op">=</span><span class="st">"cos"</span>, order<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   monotonicity<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># check for non-monotonicity -- actually no problems</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/mrds/man/check.mono.html" class="external-link">check.mono</a></span><span class="op">(</span><span class="va">ds.model.cos23</span><span class="op">$</span><span class="va">ddf</span>, plot<span class="op">=</span><span class="cn">TRUE</span>, n.pts<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># include both a covariate and adjustment terms in the model</span></span></span>
<span class="r-in"><span><span class="va">ds.model.cos2.sex</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, <span class="fl">4</span>, adjustment<span class="op">=</span><span class="st">"cos"</span>, order<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                        monotonicity<span class="op">=</span><span class="cn">FALSE</span>, formula<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># check for non-monotonicity -- actually no problems</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/mrds/man/check.mono.html" class="external-link">check.mono</a></span><span class="op">(</span><span class="va">ds.model.cos2.sex</span><span class="op">$</span><span class="va">ddf</span>, plot<span class="op">=</span><span class="cn">TRUE</span>, n.pts<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># truncate the largest 10% of the data and fit only a hazard-rate</span></span></span>
<span class="r-in"><span><span class="co"># detection function</span></span></span>
<span class="r-in"><span><span class="va">ds.model.hr.trunc</span> <span class="op">&lt;-</span> <span class="fu">ds</span><span class="op">(</span><span class="va">tee.data</span>, truncation<span class="op">=</span><span class="st">"10%"</span>, key<span class="op">=</span><span class="st">"hr"</span>,</span></span>
<span class="r-in"><span>                        adjustment<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ds.model.hr.trunc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare AICs between these models:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ds.model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ds.model.cos2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">ds.model.cos23</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

